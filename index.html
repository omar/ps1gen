<!-- Yes this is using Twitter Bootstrap -->
<!doctype html>

<html lang="en">
<head>
   <meta charset="utf-8" />
   <title>PS1 Bash Prompt Generator and Reference</title>
   <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />

   <style>

      body {
         background-image: url(shattered.png);
      }

      #title {
        color: #3a87ad;
      }

      li.draggable {
        padding: 5px;
        border: solid 1px #ccc;
        border-radius: 5px;
        margin: 0 10px 10px 0;
        text-align: center;
        position: relative;
        background-color: #f9f9f9;
        list-style: none;
        float: left;
        clear: both;
      }

      .category {
        padding: 0;
        margin: 0 25px 10px 0;
        display: inline-block;
        text-align: left;
      }

      .category h5 {
        margin: 0 0 10px 0;
      }

      .options {
        margin: 0;
      }

      li .hold {
         cursor: move;
         position: absolute;
         left: -6px;
         bottom: -6px;
      }

      li .delete {
         position: absolute;
         cursor: pointer;
         top: -6px;
         right: -6px;
      }

      .category .delete {
         display: none;
      }

      .dropdown-menu {
         text-align: left;
         min-width: auto;
      }

      .dropdown-menu li > a {
         padding: 3px 10px;
      }

      #sortable li.ui-sortable-placeholder {
         background-color: #d9edf7;
         border: dashed 1px #3a87ad;
         visibility: visible !important;
         
         margin: 0 10px;
         padding: 0;
      }

      a.dropdown-toggle {
         margin-top: 1px;
      }

      .draggable {

      }

      .popover-title {
         display: none;
      }

      .color-picker-add {
         display: inline-block;
      }

      .color-picker {
         width: auto;
      }

      #selected {
         min-width:100px;
         min-height: 100px;
         border: dashed 2px #333;
      }

      #sortable li.draggable {
        clear: none;
        float: none;
        display: inline-block;
      }

      #draggables, 
      #sortable {
         margin: 10px;
         min-height: 100px;
      }

      .example {
         font-size: 12px;
         color: #c4c5c6;
         display: block;
         border-bottom: dashed 1px #ccc;
         margin-bottom: 3px;
         font-family: Monaco,Menlo,Consolas,"Courier New",monospace;
      }

      .example input {
         color: #c4c5c6;
         margin: 0 0 2px 0;
         padding: 2px 4px;
         font-size: 12px;
         font-family: Monaco,Menlo,Consolas,"Courier New",monospace;
      }

      .color-preview {
         width: 10px;
         height: 10px;
         display: inline-block;
      }

      .popover {
         width: 200px;
         font-size: 12px;
      }

      #preview,
      #output {
         background-color: #333;
         padding: 5px;
         min-height: 20px;
         font-family: Monaco,Menlo,Consolas,"Courier New",monospace;
         font-size: 12px;
      }

      #output {
         color: #f9f9f9;
      }


      #preview-background {
         margin-bottom: 5px;
      }

      .preview-example {
         color: #c4c5c6;
         float: left;
      }

      fieldset {
        margin: 0 0 10px 0;
      }

      fieldset legend {
        margin-bottom: 10px; 
      }

      footer {
        padding: 10px 0 20px 0;
      }

      h3 {
        margin: 0;
        line-height: 30px;
      }

      footer {
        border-top: solid 1px #333;
      }

      .section {
        margin-bottom: 10px;
      }

      .content {
        padding: 10px;
        background-color: #f0f0f0;
        border-radius: 5px;
      }

      .content small {
        font-size: 14px;
        margin-bottom: 4px;
        display: block;
      }

      #categories {
        margin-top: 5px;
        text-align: center;
      }

      #legend {
        list-style: none;
        margin-left: 0;
      }

      #legend .example {
        display: inline-block;
        padding: 0 2px;
        background-color: #f9f9f9;
      }

      #legend li {
        font-size: 12px;
      }

      #cursor {
        color: white;
        float: left;
      }

      #github-buttons {
        margin-top: 20px;
      }
   </style>
</head>
<body>
  <div class="container">
    <div id="github-buttons" class="pull-right">
      <iframe src="http://ghbtns.com/github-btn.html?user=omar&repo=ps1gen&type=watch&count=true&size=large"
    allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30"></iframe>

      <iframe src="http://ghbtns.com/github-btn.html?user=omar&type=follow&size=large"
    allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30"></iframe>
    </div>
    <h1 id="title">ps1gen <small>a PS1 generator and reference</small></h1>
    
    <hr />
    <div class="section row">
      <div class="span2">
        <h3>Options</h3>

        <h6>Legend</h6>
        <ul id="legend">
          <li>
            <span class="example">Text</span>: example output
          </li>
          <li>
            <a href="#" class="btn btn-mini pop-it" data-content="Symbol descrption">\w</a> : symbol (click)
          </li>
          <li>
            <div class="color-picker-add"></div> : text color (click)
          </li>
          <li>
            <input type="checkbox" checked="checked" /> : trailing whitespace
          </li>
          <li>
            <i class="icon-remove"></i>: delete
          </li>
          <li>
            <i class="icon-move"></i>: move
          </li>
        <ul>
      </div>
      <div class="span10">
        <div class="content">
          <small>Drag items from here to the 'Selected' area</small>
          <div id="categories">
            <div class="category">
              <h5>Directory</h5>
              <ul id="directory" class="options">
              </ul>
            </div>

            <div class="category">
              <h5>Date</h5>
              <ul id="date" class="options">
              </ul>
            </div>

            <div class="category">
              <h5>Time</h5>
              <ul id="time" class="options">
              </ul>
            </div>

            <div class="category">
              <h5>Computer</h5>
              <ul id="computer" class="options">
              </ul>
            </div>

            <div class="category">
              <h5>Other</h5>
              <ul id="other" class="options">
                <li class="draggable new-item">
                  <i class="icon-remove delete"></i>
                  <span class="example">
                    <input type="text" class="input-mini" />
                  </span>
                  <i class="icon-move hold"></i>
                  <a href="#" class="btn btn-mini pop-it" data-content='Enter custom text. Automatically escapes \ and "'>txt</a>
                  <div class="color-picker-add"></div>
                  <input type="checkbox" checked="checked" class="trailing-whitespace" />
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section row">
      <div class="span2">
        <h3>Selected</h3>
      </div>
      <div class="span10">
        <div class="content">
          <small>Items placed here will be used to generate the PS1 string</small>
          <div id="selected">
            <ul id="sortable">
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="section row">
      <div class="span2">
        <h3>Preview</h3>
        <div id="preview-background">
          <span>Background</span>
          <div class="btn-group">
             <a href="#" class="btn btn-mini btn-inverse active" data-color="#333">Dark</a>
             <a href="#" class="btn btn-mini" data-color="#f9f9f9">Light</a>
          </div>
        </div>
      </div>
      <div class="span10">
        <div class="content">
          <small>What your command prompt will look like (trailing spaces added automatically)</small>
          <div id="preview">
            <span id="preview-text"></span><span id="cursor">_</span>
          </div>
        </div>
      </div>
    </div>

    <div class="section row">
      <div class="span2">
        <h3>Output</h3>
      </div>
      <div class="span10">
        <div class="content">
          <small>The PS1 string that matches the items selected - place this in <code>~/.bashrc</code></small>
          <div id="output"></div>
        </div>
      </div>
    </div>

<hr />

    <div class="section row">
      <div class="span2">
        <h3>References</h3>
      </div>
      <div class="span10">
        <div class="content">
          <ul>
            <li><a href="http://www.gnu.org/software/bash/manual/bashref.html#Printing-a-Prompt">bash manual: Controlling the Prompt</a> (gnu.org)</li>
            <li><a href="http://www.ibm.com/developerworks/library/l-tip-prompt/">Tip: Prompt magic</a> (ibm.com)</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="section row">
      <div class="span2">
        <h3>Inspiration</h3>
      </div>
      <div class="span10">
        <div class="content">
          <ul>
            <li><a href="http://www.kirsle.net/wizards/ps1.html#help">Noah's Bash $PS1 Generator</a> (kirsle.net)</li>
            <li><a href="http://ps1gen.coding-journal.com/">PS1 Bash Prompt Generator</a> (ps1gen.coding-journal.com)</li>
            <li><a href="http://xta.github.com/HalloweenBash/">Halloween Bash Profile Generator (http://xta.github.com/HalloweenBash)</a></li>
          </ul>
        </div>
      </div>
    </div>

    <footer>
      ps1gen by <a href="http://omar.io">Omar Khudeira</a>
    </footer>
  </div>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <script src="underscore-min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js"></script>
  
  <script type="text/template" id="item-template">
      <li class="draggable new-item">
        <i class="icon-remove delete"></i>
        <span class="example">{{ example }}</span>
        <i class="icon-move hold"></i>
        <a href="#" class="btn btn-mini pop-it" data-content="{{ description }}">{{ text }}</a>
        <div class="color-picker-add"></div>
        <input type="checkbox" checked="checked" class="trailing-whitespace" />
      </li>
  </script>

  <script type="text/template" id="color-template">
  <div class="btn-group">
    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
      <span class="color-preview" style="background-color: #c4c5c6" data-color-code="37m"></span>
    </a>
    <ul class="dropdown-menu">
      {[ _.each(colors, function (color) { ]}
        <li>
          <a href="#" class="color-pick">
            <span class="color-preview" style="background-color:{{ color.hex }}" data-color-code="{{ color.code }}"></span>
            {{ color.text }}
          </a>
        </li>
      {[ }); ]}
    </ul>
  </div>
  </script>

  <script>
    $(document).ready(function() {
      setCursorBlink();
      populateItems();

      $( "#sortable" ).sortable({
        revert: true,
        stop: function () {
         updateOutput();
        }
      });
      $( ".category li" ).draggable({
        connectToSortable: "#sortable",
        helper: "clone",
        revert: "invalid",
        cursorAt: { left: 0 },
        stop: function() {
          bindClicks();
          bindTextChange();
          updateOutput();
          $('.pop-it').popover(popoverOptions);
        }
      });
      $( "ul, li" ).disableSelection();

      var popoverOptions = {
        placement: 'bottom'
      };

      $('.pop-it').popover(popoverOptions);

      $('.color-picker-add').replaceWith(colorsDropdown);
      bindClicks();
    });

    _.templateSettings = {
      evaluate : /\{\[([\s\S]+?)\]\}/g,
      interpolate : /\{\{(.+?)\}\}/g
    };

    var symbolsTable = [
      ['\\u', 'Username of current user', 'omar', 'computer'],
      ['\\h', 'Hostname, up to the first \'.\'', 'mybox', 'computer'],
      ['\\H', 'Hostname', 'mybox.local', 'computer'],

      ['\\d', 'Date in "Weekday Month Date" format', 'Tue May 26', 'date'],
      ['\\t', 'Time in 24-hour HH:MM:SS format', '23:01:01', 'time'],
      ['\\T', 'Time in 12-hour HH:MM:SS format', '11:01:01', 'time'],
      ['\\@', 'Time in 12-hour format with am/pm', '11:01:01 AM', 'time'],

      ['\\w', 'Current working directory, with $HOME abbreviated with a tilde (uses the $PROMPT_DIRTRIM variable)', '~/ps1gen', 'directory'],
      ['\\W', 'Basename of the current working directory ', 'ps1gen', 'directory'],

      ['\\#', 'Command number (this will count up at each prompt, as long as you type something)', '5', 'other']
    ];

    var symbols = (function() {
      var items = [];

      for(var i in symbolsTable) {
        var symbol = symbolsTable[i];
        var text = symbol[0];
        var description = symbol[1].replace(/"/g, "'");
        var example = symbol[2];
        var category = symbol[3];

        var item = {
          text: text,
          description: description,
          example: example,
          category: category
        };

        items.push(item);
      }

      return items;
    })();

    var colorsTable = [
      ['Gray', '37m', '#c4c5c6'],
      ['Black', '30m', '#000'],
      ['Red', '31m', '#ba2f1e'],
      ['Green', '32m', '#22b421'],
      ['Yellow', '33m', '#a4a423'],
      ['Blue' , '34m', '#3f2add'],
      ['Pink' , '35m', '#cd31cd'],
      ['Cyan', '36m', '#2db2c1']
    ];

    var colors = (function() {
      var items = [];

      for(var i in colorsTable) {
        var color = colorsTable[i];
        var text = color[0];
        var code = color[1];
        var hex = color[2];

        var item = {
          text: text,
          code: code,
          hex: hex
        };

        items.push(item);
      }

      return items;
    })();

    var colorsDropdown = (function() {
      var template = _.template($('#color-template').html());
      var html = template({ colors: colors });
      return html;
    })();

    var populateItems = function() {
      var template = _.template($('#item-template').html());

      var html = [];
      for(var i in symbols) {
        var symbol = symbols[i];
        
        if(html[symbol.category] === undefined)
          html[symbol.category] = '';

        html[symbol.category] += template(symbols[i]);
      }

      for(var i in html) {
        $('#' + i).prepend(html[i]);
      }
    };

    var bindClicks = function() {
      $('a.color-pick').on('click', function (e) {
        var $this = $(this);
        var color = $this.find('.color-preview').css('background-color');
        var code = $this.find('.color-preview').attr('data-color-code');

        $this.parents('.new-item').find('.example, .example input').css('color', color);
        $this.parents('.btn-group').find('.dropdown-toggle .color-preview').css('background-color', color);
        $this.parents('.btn-group').find('.dropdown-toggle .color-preview').attr('data-color-code', code);
        $this.parents('ul').find('li').removeClass('active');
        $this.parent('li').addClass('active');

        updateOutput();
        e.preventDefault(); 
        return true;
      });

      $('a.pop-it').on('click', function(e) {
        e.preventDefault(); 
        return true;
      });

      $('.delete').click(function(e) {
        $(this).parent('li').remove();
        updateOutput();
        e.preventDefault(); 
        return true;
      });

      $('#preview-background a').click(function(e) {
         $('#preview-background a').removeClass('active');
         var $this = $(this);
         $this.toggleClass('active');
         $('#preview').css('background-color', $this.data('color'));
         e.preventDefault(); 
         return true;
      });

      $('.trailing-whitespace').click(function (e) {
        updateOutput();
      });
    };

    var bindTextChange = function() {
      $('#selected .example input').on('keyup', function() {
        updateOutput();
      });
    };

    var parseSelectedItems = function() {
      var items = [];

      var text = '';
      var preview = '';
      var $selected = $('#sortable li.new-item:not(.ui-sortable-placeholder)');
      if($selected.size() == 0)
        return {
          text: '',
          preview: '',
          items: []
        };

      $selected.each(function (index) {
        var $this = $(this);

        var colorCode = $this.find('.dropdown-toggle .color-preview').attr('data-color-code');
        var symbol = $this.find('.pop-it').text();
        var whitespace = $this.find('.trailing-whitespace').is(':checked');
        
        var $clone = $this.find('.example').clone().attr('class', 'preview-example');

        if(symbol === 'txt') {
          symbol = $this.find('input').val();
          symbol = symbol.replace(/"/g, '\\"')
                         .replace(/\\/g, '\\\\');
          $clone.html($clone.find('input').val());
        }
          
        text += '\\e[0;' + colorCode + symbol;

        if(whitespace) {
          text += ' ';  
          $clone.append('&nbsp;');
        } 

        preview += $clone[0].outerHTML;    
        
        var item = {
          colorCode: colorCode,
          symbol: symbol
        };
        items.push(item);
      });

      text += '\\e[0m';

      var result = {
        text: text,
        preview: preview,
        items: items
      };

      return result;
    };

    var updateOutput = function() {
      var result = parseSelectedItems();
      
      var text = 'export PS1="' + result.text + '"';
      $('#output').html(text);

      $('#preview-text').html(result.preview);
    };

    var setCursorBlink = function() {
      var func = function () {
        $('#cursor').toggle();
      };

      var interval = 500;

      setInterval(func, interval);
    };
  </script>
</body>
</html>